<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>CoSneakers Web</title>

  <!-- Font Awesome icons required for MDBootstrap Datatables  -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">

    <!-- Bootstrap core CSS -->
    <link href="./static/css/bootstrap.min.css" rel="stylesheet">

    <!-- MDBootstrap Datatables  -->
    <link href="./static/css/addons/datatables.min.css" rel="stylesheet">

    <!--Link to toastr.css -->
    <link href="./static/css/toastr.min.css" rel="stylesheet"/>

    <style>
      /* Vanilla Bootstrap  */
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }
      /* Vanilla Bootstrap  */

      /* MDBootstrap Datatables  */
        table.dataTable thead .sorting:after,
        table.dataTable thead .sorting:before,
        table.dataTable thead .sorting_asc:after,
        table.dataTable thead .sorting_asc:before,
        table.dataTable thead .sorting_asc_disabled:after,
        table.dataTable thead .sorting_asc_disabled:before,
        table.dataTable thead .sorting_desc:after,
        table.dataTable thead .sorting_desc:before,
        table.dataTable thead .sorting_desc_disabled:after,
        table.dataTable thead .sorting_desc_disabled:before {
            bottom: .5em;
        }
        /* MDBootstrap Datatables  */
    </style>

    <!-- Custom styles for this template -->
    <!--<link href="./static/css/form-validation.css" rel="stylesheet">-->

  </head>
  <body class="bg-light">
    <div class="container">
      <div class="py-5 text-center">
        <img class="d-block mx-auto mb-4" src="./static/img/logo_black.png" alt="" height="96">
        <h2>Sneaker Registry</h2>
        <p class="lead">Add and List Sneaker Purchases.</p>
      </div>

    <!--Bootstrap Predefined Styles-->
    <!--The Bootstrap grid system has four classes:-->
    <!--xs (for phones, stands for column extra small <= 576px)-->
    <!--sm (for tablets, stands for column extra small >= 576px)-->
    <!--md (for desktops, stands for column medium >= 768px)-->
    <!--lg (for desktops, stands for column medium >= 992px)-->
    <!--xl (for larger desktops, stands for column large >= 1200px)-->

    <!--mb sets sets margin bottom-->
    <!--mt sets sets margin top-->
    <!--btn-sm small button-->
    <!--btn-lg large button-->

      <div class="row">
        <div class="col-md-12 order-md-1">
          <h2 class="mb-3">Add new purchase</h2>
          <form class="needs-validation" novalidate onsubmit="return false" id="addSneakerForm">
            <div class="row">
              <div class="col-md-3 mb-3">
                <label for="sneakerBrand">Brand</label>
                <input type="text" class="form-control" id="sneakerBrand" placeholder="Enter name of brand..." value="" required>
                <div class="invalid-feedback">
                  Valid Brand name is required.
                </div>
              </div>
              <div class="col-md-3 mb-3">
                <label for="sneakerStyle">Style</label>
                <input type="text" class="form-control" id="sneakerStyle" placeholder="Enter name of style..." value="" required>
                <div class="invalid-feedback">
                  Valid Style name is required.
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <label for="sneakerPurchaseDate">Purchase Date</label>
                <input type="date" class="form-control" id="sneakerPurchaseDate" placeholder="Enter sneaker purchase date..." required>
                <div class="invalid-feedback">
                  Expiration date required
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-3 mb-3">
                <label for="sneakerPrice">Price</label>
                <input type="number" class="form-control" id="sneakerPrice" placeholder="Enter sneaker price..." value="" required>
                <div class="invalid-feedback">
                  Valid Brand name is required.
                </div>
              </div>
              <div class="col-md-3 mb-3">
                <label for="sneakerColour">Colour</label>
                <select class="custom-select d-block w-100" id="sneakerColour" required>
                  <option value="">Choose...</option>
                  <option>Black</option>
                  <option>White</option>
                  <option>Red</option>
                  <option>Grey</option>
                  <option>Other</option>
                </select>
                <div class="invalid-feedback">
                  Please select a valid colour.
                </div>
              </div>
            </div>

            <div class="custom-control custom-checkbox">
                <input type="checkbox" class="custom-control-input form-control" id="writeToJSONFile">
                <label class="custom-control-label" for="writeToJSONFile">Write this to JSON file</label>
            </div>

            <button class="btn btn-primary btn-sm btn-block mt-3 mb-3" type="submit" id="addSneakerBtn" onclick="addSneakerPurchase();">Add Purchase</button>
          </form>
        </div>

      </div>
      <div class="row">
          <div class="col-md-12 order-md-2">
          <hr>
          <div>
              <h2 class="mb-3">List of purchases</h2>
              <table id="dtSneakersTable" class="table">
                  <thead class="thead-dark">
                    <tr>
                      <th scope="col">#</th>
                      <th scope="col">Brand</th>
                      <th scope="col">Style</th>
                      <th scope="col">Price</th>
                      <th scope="col">Color</th>
                      <th scope="col">Purchase Date</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!--<tr>-->
                      <!--<th scope="row">1</th>-->
                      <!--<td>Brand 1</td>-->
                      <!--<td>Style 1</td>-->
                      <!--<td>Price 1</td>-->
                      <!--<td>Colour 1</td>-->
                      <!--<td>Date Bought 1</td>-->
                    <!--</tr>-->
                    <!--<tr>-->
                      <!--<th scope="row">2</th>-->
                      <!--<td>Brand 2</td>-->
                      <!--<td>Style 2</td>-->
                      <!--<td>Price 2</td>-->
                      <!--<td>Colour 2</td>-->
                      <!--<td>Date Bought 2</td>-->
                    <!--</tr>-->
                    <!--<tr>-->
                      <!--<th scope="row">3</th>-->
                      <!--<td>Brand 3</td>-->
                      <!--<td>Style 3</td>-->
                      <!--<td>Price 3</td>-->
                      <!--<td>Colour 3</td>-->
                      <!--<td>Date Bought 3</td>-->
                    <!--</tr>-->
                  <!--</tbody>-->
              </table>
          </div>
        </div>
      </div>

      <footer class="my-5 pt-5 text-muted text-center text-small">
        <p class="mb-1">&copy; 2019 CoSneakers by Julian Kanjere</p>
        <ul class="list-inline">
          <li class="list-inline-item"><a href="#">Privacy</a></li>
          <li class="list-inline-item"><a href="#">Terms</a></li>
          <li class="list-inline-item"><a href="#">Support</a></li>
        </ul>
      </footer>
    </div>
    <!-- SCRIPTS -->
    <!-- JQuery -->
    <script type="text/javascript" src="./static/js/jquery-3.4.1.min.js"></script>

    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript" src="./static/js/bootstrap.bundle.min.js"></script>

    <!-- Bootstrap tooltips -->
    <script type="text/javascript" src="./static/js/popper.min.js"></script>

    <!-- Boostrap form validation -->
    <!--<script src="./static/js/form-validation.js"></script>-->

    <!-- MDB core JavaScript -->
    <script type="text/javascript" src="./static/js/mdb.min.js"></script>

    <!-- MDBootstrap Datatables JS  -->
    <script type="text/javascript" src="./static/js/addons/datatables.min.js"></script>

    <!--Link to toastr.js -->
    <script type="text/javascript" src="./static/js/toastr.min.js"></script>


    <!-- Custom JS  -->
    <script type="text/javascript" src="./static/js/app.js"></script>

    <!--MDBootstrap Datatables initialisation-->
    <script>
        $(document).ready(function () {
            fetch("/db/my_sneakers.json")
            .then(response => response.json())
            .then(function(sneakerJsonArray) {
                //console.log(sneakerJsonArray);

                var sneakerArray = sneakerJsonArray;
                //console.log("sneakerArray.length " + sneakerArray.length);

                var tableRowCount = $('#dtSneakersTable tr').length;
                //console.log("tableRowCount " + tableRowCount );

                var dtSneakersTableRef = $('#dtSneakersTable').DataTable();
                var newRowNumber = 0;
                for (var i = 0; i < sneakerArray.length; i++) {
                    newRowNumber = tableRowCount + i;
                    //console.log("newRowNumber " + newRowNumber);
                    //console.log("sneakerArray[i] " + sneakerArray[i]);
                    //console.log("sneakerArray[i].Brand " + sneakerArray[i].Brand);

                    dtSneakersTableRef.row.add( {
                            0: newRowNumber,
                            1: sneakerArray[i].Brand,
                            2: sneakerArray[i].Style,
                            3: sneakerArray[i].Price,
                            4: sneakerArray[i].Color,
                            5: sneakerArray[i].Date
                        } ).draw();

                    // var sneakerTableRowHtml = '<tr><th scope="row">'+newRowNumber+'</th>' +
                    //     '<td>'+sneakerArray[i].Brand+'</td>' +
                    //     '<td>'+sneakerArray[i].Style+'</td>' +
                    //     '<td>'+sneakerArray[i].Price+'</td>' +
                    //     '<td>'+sneakerArray[i].Color+'</td>' +
                    //     '<td>'+sneakerArray[i].Date+'</td>' +
                    //     '</tr>';
                    // $(dtSneakersTable).find('tbody').append(sneakerTableRowHtml);
                }
            });
            //$('#dtSneakersTable').DataTable();
            //$('#dtSneakersTable').DataTable({"searching": false}); //false to disable search (or any other option)
            $('.dataTables_length').addClass('bs-select');

            //$('#addSneakerBtn').click(addSneakerPurchase); //rather user onlick directly on the button element
        });

        function addSneakerPurchase() {
            var addSneakerFormRef = document.getElementById('addSneakerForm');

            // if form validation fails, prevent form submission
            if (addSneakerFormRef.checkValidity() === false) {
                //event.preventDefault();
                event.stopPropagation();
                //console.log("addSneakerFormRef.checkValidity() " + addSneakerFormRef.checkValidity() )

                addSneakerFormRef.classList.add('was-validated')

                // Display a success toast with no title
                toastr.error('Error adding new sneaker, please check and try again!');

                return;
            };
            var dtSneakersTableRef = $('#dtSneakersTable').DataTable();
            var rowCount = dtSneakersTableRef.data().count();
            // console.log("Datatable row count " + rowCount);
            var newRowNumber = rowCount + 1;

            var trRowNum = newRowNumber;
            var trSneakerBrand = document.getElementById("sneakerBrand").value;
            var trSneakerStyle = document.getElementById("sneakerStyle").value;
            var trSneakerPrice = document.getElementById("sneakerPrice").value;
            var trSneakerColour = $("#sneakerColour :selected").text(); //$("#sneakerColour :selected").value()
            var trSneakerPurchaseDate =  document.getElementById("sneakerPurchaseDate").value;

            dtSneakersTableRef.row.add( {
                            0: trRowNum,
                            1: trSneakerBrand,
                            2: trSneakerStyle,
                            3: trSneakerPrice,
                            4: trSneakerColour,
                            5: trSneakerPurchaseDate
                        } ).draw();

            // Display a success toast with no title
            toastr.success('New sneaker added!');

            var writeToJSONFileValue = document.getElementById("writeToJSONFile").checked;

            addSneakerFormRef.classList.remove('was-validated');
            addSneakerFormRef.reset();

            console.log("writeToJSONFileValue " + writeToJSONFileValue )
            if (writeToJSONFileValue === true){
                var newSneakerDetailsDict = {
                    "Brand": trSneakerBrand,
                    "Style": trSneakerStyle,
                    "Price": trSneakerPrice,
                    "Color": trSneakerColour,
                    "Date": trSneakerPurchaseDate
                };
                var addSneakerRequest = new XMLHttpRequest();
                addSneakerRequest.open('post', '/addSneaker');
                addSneakerRequest.setRequestHeader("Content-Type", "application/json;charset=UTF-8");

                // console.log("Request being sent " + JSON.stringify({
                //     'newSneakerDetails':newSneakerDetailsDict,
                //     'filePath': "./src/db/",
                //     'fileName': "my_sneakers.json"
                //         }
                //     ));

                addSneakerRequest.send(JSON.stringify({
                    'newSneakerDetails':newSneakerDetailsDict,
                    'filePath': "./src/db/",
                    'fileName': "my_sneakers.json"
                        }
                    )
                );

                // Display a success toast with no title
                toastr.success('New sneaker added to JSON file!');
            }
        };
    </script>
  </body>
</html>
